{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "d7e1936c",
   "metadata": {},
   "source": [
    "# 🧠 Alzheimer MRI Sınıflandırması: Transfer Öğrenme ve Optimizasyon\n",
    "\n",
    "Bu notebook, temel bir CNN modelinin sınırlılıklarını aşarak, transfer öğrenme ve gelişmiş optimizasyon teknikleriyle modelimizin performansını nasıl zirveye taşıdığımızı belgelemektedir. Bu aşama, projemizin en önemli dönüm noktasıdır."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c7e26cac",
   "metadata": {
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "outputs": [],
   "source": [
    "import torch\n",
    "import torch.nn as nn\n",
    "import torch.optim as optim\n",
    "import os\n",
    "import sys\n",
    "\n",
    "# Proje kök dizinini Python yoluna ekle\n",
    "sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))\n",
    "\n",
    "from src.model import get_model\n",
    "from src.dataset import build_dataloaders\n",
    "from src.transforms import base_train_transform, default_transform\n",
    "from src.losses import FocalLoss\n",
    "from src.evaluate import evaluate_model\n",
    "from src.visualization import plot_training, save_confusion_matrix, save_classification_report\n",
    "\n",
    "# Not: Bu notebook'ta eğitim döngüsü tekrarlanmayacaktır.\n",
    "# Yalnızca stratejiler ve sonuçlar anlatılacaktır."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a20e3ff0",
   "metadata": {},
   "source": [
    "### 1. Transfer Öğrenme Modeli (İlk Deneme)\n",
    "\n",
    "Baseline modelinin aksine, bu aşamada **ImageNet** üzerinde önceden eğitilmiş bir **ResNet50** mimarisi kullanılmıştır. İlk denemede, modelin sadece son katmanları eğitilmiştir (`fine-tuning` yok).\n",
    "\n",
    "**Giriş:**\n",
    "* **`use_sampler=True`**: Sınıf dengesizliği sorununu çözmek için `WeightedRandomSampler` kullanıldı.\n",
    "* **`use_focal=False`**: Kayıp fonksiyonu olarak `CrossEntropyLoss` kullanıldı.\n",
    "\n",
    "**Sonuçlar:**\n",
    "\n",
    "Bu strateji, modelin bir önceki plato seviyesini aşmasını sağladı, ancak hala `VeryMildDemented` sınıfında zorlanıyordu.\n",
    "\n",
    "* **Genel Doğruluk:** %73\n",
    "* **`VeryMildDemented` F1-Score:** %38\n",
    "\n",
    "**Çıkarım:**\n",
    "Model, `ModerateDemented` ve `NonDemented` sınıflarını yüksek doğrulukla ayırt edebilirken, `VeryMildDemented` sınıfı için hala zorlanıyordu. Bu, modelin genelleme yeteneğinin artırılması gerektiğini gösteriyordu."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "08e07271",
   "metadata": {},
   "source": [
    "### 2. Final Model (İyileştirilmiş Strateji)\n",
    "\n",
    "Modelin `VeryMildDemented` sınıfındaki performansını artırmak ve genel genelleme yeteneğini maksimize etmek için birleşik bir strateji uygulandı.\n",
    "\n",
    "**Uygulanan İyileştirmeler:**\n",
    "1.  **Fine-tuning:** **ResNet50'nin tüm katmanları (`freeze_backbone=False`)** yeniden eğitime açıldı.\n",
    "2.  **`L2 Regularization`:** Aşırı öğrenmeyi önlemek için `Adam` optimizer'a `weight_decay=1e-4` parametresi eklendi.\n",
    "3.  **Düşük Öğrenme Oranı (`lr=1e-4`):** Önceden eğitilmiş ağırlıkları korumak için öğrenme oranı düşürüldü.\n",
    "4.  **Birleşik Dengeleme:** **`WeightedRandomSampler`** ve **`Focal Loss`** stratejileri birleştirilerek, modelin `VeryMildDemented` gibi zor sınıflardaki her hatasını daha ağır bir şekilde cezalandırması sağlandı.\n",
    "\n",
    "**Sonuçlar:**\n",
    "\n",
    "Bu birleşik strateji, modelin performansında dramatik bir sıçrama yarattı.\n",
    "\n",
    "\n",
    "\n",
    "* **Genel Doğruluk:** %97.47\n",
    "* **Sınıf Bazlı F1-Skorları:**\n",
    "    * `MildDemented`: %98\n",
    "    * `ModerateDemented`: %100 🏆\n",
    "    * `NonDemented`: %97\n",
    "    * `VeryMildDemented`: %97"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "92cdc202",
   "metadata": {},
   "source": [
    "#### **Çıkarım:**\n",
    "* `Training` ve `Validation` eğrileri arasındaki makas kapanmıştır.\n",
    "* `Validation Accuracy` %97'lere ulaşarak modelin genelleme yeteneğinin zirveye ulaştığı kanıtlanmıştır.\n",
    "* **`VeryMildDemented`** sınıfı için elde edilen **%97'lik F1-score**, en zorlu problemin başarıyla çözüldüğünü gösterir.\n",
    "* `Confusion Matrix` ve `Classification Report`'a göre, model tüm sınıflar için dengeli ve güvenilir bir performans sergilemektedir."
   ]
  }
 ],
 "metadata": {
  "language_info": {
   "name": "python"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
